<!DOCTYPE html>
<html>
  <meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" name="viewport">
  <head>
    <title>Таблица Умножения</title>
    <style>
      body{
       max-width:400px;
      }

      .incorrect {
        color: red;
      }
      
      .correct {
        color: green;
      }
    
      button {
        width:100px;
        height:100px;
        margin: 10px;
      }
    </style>
  </head>
<body>


</style>

<script>
  function generateMultiplicationTable() {
    var num1 = Math.floor(Math.random() * 10) + 1;
    var num2 = Math.floor(Math.random() * 10) + 1;
    
    var correctAnswer = num1 * num2;

    var question = num1 + " x " + num2 + " = " + correctAnswer;
    
    var answers = [correctAnswer, Math.floor(Math.random() * 100), Math.floor(Math.random() * 100)];
    answers.sort(() => Math.random() - 0.5);

    var questionObject = {
      question: question,
      answers: answers
    };

    localStorage.setItem("question_" + localStorage.length, JSON.stringify(questionObject));
    
    document.write("<p style='text-align:center'>Сколько <b>" + num1 + "</b> x <b>" + num2 + "</b>?</p>");

    for (var i = 0; i < answers.length; i++) {
      document.write("<button onclick='checkAnswer(" + answers[i] + "," + correctAnswer + "," + i + ")'>" + answers[i] + "</button>");
    }
  }

  function checkAnswer(selectedAnswer, correctAnswer, index) {
    const answerBtn = document.getElementsByTagName("button")[index];
    console.log(selectedAnswer, correctAnswer, index);
    
    if (selectedAnswer === correctAnswer) {
      answerBtn.classList.add("correct");
    } else {
      answerBtn.classList.add("incorrect");
    }
    const historyObj = JSON.parse(localStorage.getItem("question_" + (localStorage.length-1)));
    
    localStorage.removeItem("question_" + (localStorage.length-1));
    
    historyObj.answer = Number(answerBtn.textContent);
    
    
    
    localStorage.setItem("question_" + localStorage.length, JSON.stringify(historyObj));
    
    sleep(400).then(() => {
      location.reload();
    });
  }

   
  function showPreviousQuestions() {
    let totalAnswers=1;
    
    for (var i = 0; i < localStorage.length-1; i++) {
      var questionObject = JSON.parse(localStorage.getItem("question_" + i));
      
      if(!questionObject?.answer){
         break;
      }
      
      document.write("<span>" + (totalAnswers) + ". " + questionObject.question + "</span>");
      
      let [question, answer] = questionObject.question.split('=');
           
      if(Number(answer)===questionObject?.answer){
         document.write("<span> Ответ: " + questionObject.answer + "</span>");
      }else{
         document.write("<span style='color: red' class='incorrect'> Ответ: " + questionObject.answer + "</span>");
      }
      
      totalAnswers++
      document.write("<br>");
      
    }
    
    document.write("<br><span>Всего вопросов: "+totalAnswers+" шт</span>");
    document.write("<br><span>Ошибок: "+document.querySelectorAll('.incorrect').length+" шт</span><br>");
    
    document.write("<button onclick='location.reload()' style='margin-top:100px'>Назад</button>");
    
  }

  function sleep (time) {
    return new Promise((resolve) => setTimeout(resolve, time));
  }
  
  generateMultiplicationTable();
</script>

<br>
<button onclick="showPreviousQuestions()" style="margin-top:100px">Ответы</button>

</body>
</html>
